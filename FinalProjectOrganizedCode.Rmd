---
title: "shinyApp"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Load packages:
```{r}
library(shiny)
library(shinythemes)
library(bslib)
library(tidyverse)
library(plotly)
library(ggplot2)
library(rjson)
```

import CDC vaccination data:

```{r}

cdcData <- read_csv("data/covid19_vaccinations_in_the_united_states.csv", skip = 2) 
cdcData <- cdcData %>% rename_with(~ gsub(" ", "_", names(cdcData)))
cdcData <- cdcData %>% rename_with(~ gsub("/", "_", names(cdcData)))
cdcData <- cdcData %>% mutate(State_Territory_Federal_Entity = gsub(" State", "", State_Territory_Federal_Entity))


#I think I need to split the data into two data frames: one where company is a variable, and one where it is not:

cdcData_agnostic <- cdcData %>% 
  select(contains("federal", ignore.case = TRUE) |
           contains("100k", ignore.case=TRUE)) %>%
  na_if("N/A") %>% 
  drop_na()

colnames(cdcData_agnostic) <- c("State", 
                               "Total_DeliveredPer100K", 
                               "18plus_DeliveredPer100K", 
                               "Total_AdministeredPer100K", 
                               "18plus_AdministeredPer100K", 
                               "65plus_AdministeredPer100K",
                               "65plus_DeliveredPer100K")

cdcData_agnostic <- cdcData_agnostic %>%
  mutate_at(vars("Total_DeliveredPer100K", 
                 "18plus_DeliveredPer100K", 
                 "Total_AdministeredPer100K", 
                 "18plus_AdministeredPer100K", 
                 "65plus_AdministeredPer100K",
                "65plus_DeliveredPer100K"), 
            list(factor))

cdcData_agnosticLong <- cdcData_agnostic %>%
  pivot_longer(
    !State,
    names_to= c("Group", ".value"),
    names_sep="_")

cdcData_company <- cdcData %>% select(contains("federal", ignore.case = TRUE) |
                                        contains("moderna", ignore.case=TRUE) | 
                                         contains("pfizer", ignore.case=TRUE) | 
                                         contains("janssen", ignore.case=TRUE))

colnames(cdcData_company) <- c("State", 
                               "TotalDelivered_Moderna", 
                               "TotalAdministered_Moderna", 
                               "PeopleFullyVaccinated_Moderna", 
                               "18plusFullyVaccinated_Moderna", 
                               "65plusFullyVaccinated_Moderna",
                               "TotalDelivered_Pfizer", 
                               "TotalAdministered_Pfizer", 
                               "PeopleFullyVaccinated_Pfizer", 
                               "18plusFullyVaccinated_Pfizer", 
                               "65plusFullyVaccinated_Pfizer",
                               "TotalDelivered_Janssen", 
                               "TotalAdministered_Janssen", 
                               "PeopleFullyVaccinated_Janssen", 
                               "18plusFullyVaccinated_Janssen", 
                               "65plusFullyVaccinated_Janssen")


cdcDataLong <- cdcData_company %>%
  pivot_longer(
    !State,
    names_to= c(".value", "manufacturer"),
    names_sep="_")


```

I'm curious to see how much of a pain it would be to incorporate the time data:

```{r}

modernaTimeLine <- read_csv("data/COVID-19_Vaccine_Distribution_Allocations_by_Jurisdiction_-_Moderna.csv")

```

